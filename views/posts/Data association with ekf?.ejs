<html>
	<head>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>
		<script src = "/jquery-highlight.js"></script>
		<link href="/jquery.upvote.css" rel="stylesheet">
		<script src = "/jquery.upvote.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/style.css"/>
		<script src="/createlinks.js"></script>
		<script src="/textaudit.js"></script>
		<script src="/PorterStemmer1980.min.js"></script>
		<script src="/highlight.js"></script>
		<title id = 'pagetitle'>Data association with ekf?
		</title>
	</head>
	<body id = 'pagebody'>
		<div id = "loginmodals"></div>
		<div id = "issuemodals"></div>
		<div id = "highlight_tool"></div>
		<div id = "reward_tool"></div>
		<div id = "comment_tool"></div>
		<div class = "container">
			<header>
				<h1>Just Another Discussion Forum</h1>
			</header>
			<div class="topnav" id="myTopnav">
				<a href="/home">Home</a>
				<a href = "#issueModal" data-toggle="modal" style = "float:right">Report Issue</a>
			</div>
			<div class = "content">
			<div id = "ques-3073" class = "post">
			<h2>Question</h2>
			<div id="vote-3073" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
				<p>Views :: 194</p>
			</div>
			<form id = "questionpostsform" method="GET" action = "/ask">
				<input type="submit" id = "quesbtn" class="btn btn-primary btn-lg" value="Ask Question">
			</form>
				<h2>Data association with ekf?</h2>
<p>Given part of the following algorithm in page 217 <a href="http://rads.stackoverflow.com/amzn/click/0262201623" rel="nofollow">probabilistic robotics</a>, this algorithm for EKF localization with unknown correspondences </p>

<p>9. for all observed features $z^{i}  = [r^{i} \ \phi^{2} \ s^{i}]^{T} $</p>

<p>10. &nbsp; &nbsp; for all landmarks $k$ in the map $m$ do</p>

<p>11. &nbsp; &nbsp; &nbsp; &nbsp; $q = (m_{x} - \bar{\mu}_{x})^{2} + (m_{y} - \bar{\mu}_{y})^{2}$</p>

<p>12. &nbsp; &nbsp; &nbsp; &nbsp; $\hat{z}^{k} = \begin{bmatrix}
\sqrt{q} \\ 
atan2(m_{y} - \bar{\mu}_{y}, m_{x} - \bar{\mu}_{x} ) - \bar{\mu}_{\theta} \\ 
m_{s} \\ \end{bmatrix}$</p>

<p>13. &nbsp; &nbsp; &nbsp; &nbsp; $ \hat{H}^{k} = \begin{bmatrix} 
h_{11} &amp; h_{12} &amp; h_{13} \\
h_{21} &amp; h_{22} &amp; h_{23} \\
h_{31} &amp; h_{32} &amp; h_{33} \\ \end{bmatrix}  $</p>

<p>14. &nbsp; &nbsp; &nbsp; &nbsp; $\hat{S}^{k} = H^{k} \bar{\Sigma} [H^{k}]^{T} + Q $</p>

<p>15. &nbsp; &nbsp; endfor </p>

<p>16. &nbsp; &nbsp; $ j(i) = \underset{k}{\operatorname{arg\,max}} \ \ det(2 \pi S^{k})^{-\frac{1}{2}} \exp\{-\frac{1}{2} (z^{i}-\hat{z}^{k})^{T}[S^{k}]^{-1} (z^{i}-\hat{z}^{k})\} $</p>

<p>17. &nbsp; &nbsp; $K^{i} = \bar{\Sigma} [H^{j(i)}]^{T} [S^{j(i)}]^{-1}$</p>

<p>18. &nbsp; &nbsp; $\bar{\mu} = \bar{\mu} + K^{i}(z^{i}-\hat{z}^{j(i)}) $</p>

<p>19. &nbsp; &nbsp; $\bar{\Sigma} = (I - K^{i} H^{j(i)}) \bar{\Sigma} $</p>

<p>20. endfor</p>

<p>My question is why the second loop ends in the line 15. Shouldn't it end after the line 19. I've checked the <a href="http://robots.stanford.edu/probabilistic-robotics/errata.html" rel="nofollow">errata</a> of this book but nothing about this issue. </p>

			</div>
			<div class = "userinfosection"  id = "userinfo-3073" data-toggle = "popover">
				<p>user name : CroCo</p>
				<p> user reputation : 1040</p>
				<p class = "tagcontent" id = "usertaginfo-3073">{'control': 18, 'pid': 4, 'slam': 16, 'manipulator': 3, 'mobile-robot': 14, 'dynamics': 6, 'errors': 2, 'data-association': 1, 'kinematics': 3, 'matlab': 6, 'kalman-filter': 21, 'motion-planning': 3, 'None': 41, 'noise': 24, 'theory': 1, 'localization': 14, 'microcontroller': 5, 'mapping': 5, 'sensor-error': 1, 'sensors': 7, 'quadcopter': 8, 'ekf': 26, 'simulation': 1, 'motion': 3}</p>
			</div><br>
			<br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-3073" class = 'collapse'>
			</div>
				<textarea id = "speech-3073" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-3073">
					<img id="start_img-3073" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-3073">Comment</button>

<h1>Answers</h1>
			<br><div id = "ans-3075"  class = "post">
				<h2>Answer</h2>
			<div id="vote-3075" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>The value $S^k$ (innovation variance) needs to be calculated for all landmarks, but the subsequent update steps (post line 16 --- after argmax), need be applied to all of the map, given the landmark update that was selected on line 16 --- the argmax.  </p>

<p>FYI, argmax searches over the list of landmarks for the landmark maximizing the equation given. It selects the index of the landmark which is <em>most likely</em> to be the landmark given the measurement value. Notice that the equation in line 16 is the gaussian multivariate pdf with the measurement and mean measurement for landmark k, normalized by the measurement variance, S.</p>

<p>There's a notation problem here, $\argmax$ should have a subscript denoting what the search is <em>over</em>. In this case, $\argmax$ is searching over $k$, since $i$ is the current measurement we're trying to associate with each of the $k=1...$ possible landmarks.</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-3075" data-toggle = "popover">
				<p>user name : Josh Vander Hook</p>
				<p> user reputation : 3960</p>
				<p class = "tagcontent" id = "usertaginfo-3075">{'None': 345}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-3075">Load Comments</button></br>
			<div id = "commentsection-3075" class = 'collapse'>
			<div id = "comment-6574" class = "comment">
				<p>so the line 16 should be included in the second loop. Am I right? About `argmax`, is it a function that accepts one observed measurement $z^{i}$ and all the predicted measurements $\hat{z}^{1:k}$ and returns the ID of the observed measurement that belongs to a certain landmark? I'm facing a problem with coding this function in Matlab. Any suggestion from programming perspective? I'm done with EKF-Localization with known correspondences however facing difficulties with unknown correspondences.</p>
			</div>
			<div id = "comment-6575" class = "comment">
				<p>Let's say we have $z^{i} = \{z^{1} \ z^{2} \}$ and $\hat{z} = \{ \hat{z}^{1} \ \hat{z}^{2} \ \hat{z}^{3} \ \hat{z}^{4} \}$ and $map^{i} =  \{m^{1} \ m^{2} \ m^{3} \ m^{4} \}$. Let's say $z^{1}$ is the observed measurement of $m^{4}$, so its predicted measurement $\hat{z}^{4}$. `argmax` is a function that associates $z^{1}$ with $\hat{z}^{4}$ and assigns the ID of $z^{1}$ to be $z^{4}$. Is this correct??</p>
			</div>
			<div id = "comment-6580" class = "comment">
				<p>That is correct, argmax(probability of $z^i|map^i$) returns $1$ since we assumed $m^4$ is the landmark that "most likely" was measured.</p>
			</div>
			<div id = "comment-6591" class = "comment">
				<p>thanks for helping me with this. I though it returns the ID not the probability. So, 1 here means $z^{1}$ represents $m^{4}$ 100 %. This might bring another question which is what about if the value 0.9 so we have some uncertainty. Should I set certain threshold to accept or reject this probability?</p>
			</div>
			<div id = "comment-6595" class = "comment">
				<p>I'm implementing the suggested change to the argmax function.</p>
			</div>
			<div id = "comment-6596" class = "comment">
				<p>No, it does not mean 100%. It means that $z^1$ has the *max* of all other probabilities. It might be 10% while all others are 9% (though that wouldn't add up to 1, you get the idea). This misunderstanding could be solved with a **google** (http://en.wikipedia.org/wiki/Arg_max) or by **testing it yourself** (http://www.mathworks.com/help/matlab/ref/max.html) -- note the first argument returned is *max* and the second is **argmax**.</p>
			</div>
			<div id = "comment-6597" class = "comment">
				<p>@Josh, let's say `probs` represents all probabilities of line 16. Now we have only $\{ z^{1} \ z^{2} \}$. For $z^{1}$, we got `probs = [0.8 0.05 0.05 0.9]`. Now we compute line 16 as following `[max, argmax] = max(probs)` which yields `argmax = 4`, so `j(i)` in line 16 is `j(i) = argmax = 4`, as a result, $z^{1}$ for $m^{4}$. Again we do same calculations for $z^{2}$ to get its argmax. Is this correct?</p>
			</div>
			<div id = "comment-6600" class = "comment">
				<p>Yup, seems legit.</p>
			</div>
			<div id = "comment-6609" class = "comment">
				<p>@Josh, thank you so much.</p>
			</div>
			<div id = "comment-6833" class = "comment">
				<p>@Josh, thanks again. The filter is now working perfectly.</p>
			</div>
			</div>
				<textarea id = "speech-3075" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-3075">
					<img id="start_img-3075" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-3075">Comment</button>
			</div>
			<div id = "resourcestab" class = "resourcestab">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#resources">Resources</a></li>
					<li><a data-toggle="tab" href="#highlights">Highlights</a></li>
				</ul>
					<div class="tab-content">
						<div id="resources" class="tab-pane fade in active">
							<h3>Links from the Page</h3>
							<div id = "resourcescontent"></div>
						</div>
						<div id="highlights" class="tab-pane fade">
							<h3>Highlights</h3>
							<div id = "highlightcontent"></div>
						</div>
			</div>
			</div>
			<footer>Moore & Peps collaboration.</footer>
	</div>
	<script src="/post.js"></script>
	<script type="text/javascript">
		$("#loginmodals").load("/loginModal.html");
		$("#issuemodals").load("/issueModal.html");
		$("#highlight_tool").load("/highlight_tool.html");
		$("#comment_tool").load("/comment_tool.html");
		$("#reward_tool").load("/reward_tool.html");
		checkLoggedInUser()
		var content = $('.content').html();
		populateResources(content)
		getHighlights()
		setOnLinksHover()
	</script>
	<script src="/media.js"></script>
	<script src="/vote.js"></script>
	<script src="/managefunction.js"></script>
	</body>
</html>