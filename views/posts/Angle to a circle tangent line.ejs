<html>
	<head>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>
		<script src = "/jquery-highlight.js"></script>
		<link href="/jquery.upvote.css" rel="stylesheet">
		<script src = "/jquery.upvote.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/style.css"/>
		<script src="/createlinks.js"></script>
		<script src="/textaudit.js"></script>
		<script src="/PorterStemmer1980.min.js"></script>
		<script src="/highlight.js"></script>
		<title id = 'pagetitle'>Angle to a circle tangent line
		</title>
	</head>
	<body id = 'pagebody'>
		<div id = "loginmodals"></div>
		<div id = "issuemodals"></div>
		<div id = "highlight_tool"></div>
		<div class = "container">
			<header>
				<h1>Just Another Discussion Forum</h1>
			</header>
			<div class="topnav" id="myTopnav">
				<a href="/home">Home</a>
				<a href = "#issueModal" data-toggle="modal" style = "float:right">Report Issue</a>
			</div>
			<div class = "content">
			<div id = "ques-9386" class = "post">
			<h2>Question</h2>
			<div id="vote-9386" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
				<p>Views :: 165</p>
			</div>
			<form id = "questionpostsform" method="GET" action = "/ask">
				<input type="submit" id = "quesbtn" class="btn btn-primary btn-lg" value="Ask Question">
			</form>
				<h2>Angle to a circle tangent line</h2>
<p>I want to simulate the detection of a moving object by a unicycle type robot. The robot is modelled with position (x,y) and direction theta as the three states. The obstacle is represented as a circle of radius r1 (<code>r_1</code> in my code). I want to find the angles <code>alpha_1</code> and <code>alpha_2</code>from the robot's local coordinate frame to the circle, as shown here:</p>

<p><a href="https://i.stack.imgur.com/HdqrO.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/HdqrO.jpg" alt="Detection of a moving object"></a></p>

<p>So what I am doing is trying to find the angle from the robot to the line joining the robot and the circle's centre (this angle is called <code>aux_t</code> in my code), then find the angle between the tangent and the same line (called <code>phi_c</code>). Finally I would find the angles I want by adding and subtracting <code>phi_c</code> from <code>aux_t</code>. The diagram I am thinking of is shown:</p>

<p><a href="https://i.stack.imgur.com/xfqZj.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/xfqZj.jpg" alt="Diagram #2"></a></p>

<p>The problem is that I am getting trouble with my code when I try to find the alpha angles: It starts calculating the angles correctly (though in negative values, not sure if this is causing my trouble) but as both the car and the circle get closer, <code>phi_c</code> becomes larger than <code>aux_t</code> and one of the alphas suddenly change its sign. For example I am getting this:</p>

<p>$$\begin{array}{c c c c} 
\text{aux_t} &amp; \text{phi_c} &amp; \text{alpha_1} &amp; \text{alpha_2} \\ \hline
\text{-0.81} &amp; \text{+0.52} &amp; \text{-1.33} &amp; \text{-0.29} \\
\text{-0.74} &amp; \text{+0.61} &amp; \text{-1.35} &amp; \text{-0.12} \\
\text{-0.69} &amp; \text{+0.67} &amp; \text{-1.37} &amp; \text{-0.02} \\
\text{-0.64} &amp; \text{+0.74} &amp; \text{-1.38} &amp; \text{+0.1} \\
\end{array}$$</p>

<p>So basically, the <code>alpha_2</code> gets wrong form here. I know I am doing something wrong but I'm not sure what, I don't know how to limit the angles from 0 to pi. Is there a better way to find the alpha angles?</p>

			</div>
			<div class = "userinfosection"  id = "userinfo-9386" data-toggle = "popover">
				<p>user name : Wobbler28</p>
				<p> user reputation : 30</p>
				<p class = "tagcontent" id = "usertaginfo-9386">{'None': 0, 'localization': 1, 'geometry': 5, 'kinematics': 5, 'matlab': 4, 'mobile-robot': 4}</p>
			</div><br>
			<br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-9386">Load Comments</button></br>
			<div id = "commentsection-9386" class = 'collapse'>
			<div id = "comment-17055" class = "comment">
				<p>Why you are making it so complicated?? First Find the angle between the robot and the center of the circle (i.e. angle = atan2(P2-RobotY/P1-RobotX) - RobotHeadingAngle), then based on this angle, find the rest. I will probably come back to this later with more details but I hope you got it.</p>
			</div>
			<div id = "comment-17063" class = "comment">
				<p>Hi, I'm not sure if I'm understanding you correctly, but I think what you wrote is what I am doing. I would appreciate your clarification, thanks for your answer.</p>
			</div>
			<div id = "comment-17065" class = "comment">
				<p>Those numbers look exactly right to me. -values are to the left. The + value is to the right. The circle is now so close that one edge of it is to the right. There is no issue here that I see.</p>
			</div>
			<div id = "comment-18627" class = "comment">
				<p>There might be a problem with egocentric and global coordinates--you might want to make sure that your angles are defined consistently and that they stay within the defined range (e.g. $(-\pi,\pi]$).</p>
			</div>
			</div>
				<textarea id = "speech-9386" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-9386">
					<img id="start_img-9386" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-9386">Comment</button>

<h1>Answers</h1>
			<br><div id = "ans-9390"  class = "post">
				<h2>Answer</h2>
			<div id="vote-9390" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">0</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><pre><code>function [boundedAngle] = BoundAngle (unboundedAngle)
while unboundedAngle &lt; -pi
    unboundedAngle = unboundedAngle + 2*pi;
end
while unboundedAngle &gt; pi
    unboundedAngle = unboundedAngle - 2*pi;
end
boundedAngle = unboundedAngle;
return:
</code></pre>

<p>The above code writes a (Matlab) function to limit angles between +/-pi. You say the angle should be between 0 and pi, but that only means 0-180 degrees. What if the object is behind you? If you want to ignore it, that's your choice, but you can't shift in pi (180 degree) increments and expect to get a valid answer. </p>

<p>Regarding the sign change, that appears to be expected, based on your drawing. I'm not sure what the issue is that you're having with the results.</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-9390" data-toggle = "popover">
				<p>user name : Chuck</p>
				<p> user reputation : 8534</p>
				<p class = "tagcontent" id = "usertaginfo-9390">{'actuator': 7, 'None': 616, 'dynamics': 7, 'joint': 7}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-9390">Load Comments</button></br>
			<div id = "commentsection-9390" class = 'collapse'>
			<div id = "comment-16635" class = "comment">
				<p>Thanks for your answer. I am not completely sure, but as far as I understand the "vision" of the robot is a 0-180 degrees laser sensor and the robot cannot actaully see what is at its back, but I'm going to find out more about this. Regarding the sign, it seemed unintuitive to me but as you say it seems to be correct. Sadly the final result doesn't match the expected so I have to continue looking for the problem. Regards</p>
			</div>
			<div id = "comment-17056" class = "comment">
				<p>@Chuck, wrapping the angle is a technical issue for this post. It seems to me there is a problem with the formula that determines the angles.</p>
			</div>
			</div>
				<textarea id = "speech-9390" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-9390">
					<img id="start_img-9390" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-9390">Comment</button>
			<br><div id = "ans-9632"  class = "post">
				<h2>Answer</h2>
			<div id="vote-9632" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>First, determine the angle $\phi$ between the robot $&lt;\!a_{x},a_{y},\theta\!&gt;$ and the target $&lt;\!p_{x},p_{y}\!&gt;$ as follows </p>

<p>$$
\phi = \tan^{-1} \left( \frac{ p_{y} - a_{y} }{ p_{x} - a_{x} } \right) - \theta
$$</p>

<p>See the below picture,</p>

<p><a href="https://i.stack.imgur.com/BAwLD.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/BAwLD.png" alt="enter image description here"></a></p>

<p>Based on $\phi$, you can determine the rest. </p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-9632" data-toggle = "popover">
				<p>user name : CroCo</p>
				<p> user reputation : 1040</p>
				<p class = "tagcontent" id = "usertaginfo-9632">{'control': 18, 'pid': 4, 'slam': 16, 'manipulator': 3, 'mobile-robot': 14, 'dynamics': 6, 'errors': 2, 'data-association': 1, 'kinematics': 3, 'matlab': 6, 'kalman-filter': 21, 'motion-planning': 3, 'None': 41, 'noise': 24, 'theory': 1, 'localization': 14, 'microcontroller': 5, 'mapping': 5, 'sensor-error': 1, 'sensors': 7, 'quadcopter': 8, 'ekf': 26, 'simulation': 1, 'motion': 3}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-9632">Load Comments</button></br>
			<div id = "commentsection-9632" class = 'collapse'>
			<div id = "comment-18628" class = "comment">
				<p>Assuming that $\theta\in(-\pi,\pi]$, what should the domains of the other angles be?</p>
			</div>
			<div id = "comment-19887" class = "comment">
				<p>@NBCKLY, which angles? and why you're assuming that $\theta \in (-\pi,\pi]$. This is the true range of the angle.</p>
			</div>
			</div>
				<textarea id = "speech-9632" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-9632">
					<img id="start_img-9632" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-9632">Comment</button>
			</div>
			<div id = "resourcestab" class = "resourcestab">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#resources">Resources</a></li>
					<li><a data-toggle="tab" href="#summary">Summary</a></li>
				</ul>
					<div class="tab-content">
						<div id="resources" class="tab-pane fade in active">
							<h3>Resources</h3>
							<div id = "resourcescontent"></div>
						</div>
						<div id="summary" class="tab-pane fade">
							<h3>Summary</h3>
							<div id = "summarycontent"></div>
						</div>
			</div>
			</div>
			<footer>Moore & Peps collaboration.</footer>
	</div>
	<script src="/post.js"></script>
	<script type="text/javascript">
		$("#loginmodals").load("/loginModal.html");
		$("#issuemodals").load("/issueModal.html");
		$("#highlight_tool").load("/highlight_tool.html");
		checkLoggedInUser()
		var content = $('.content').html();
		populateResources(content)
		getHighlights()
		setOnLinksHover()
	</script>
	<script src="/media.js"></script>
	<script src="/vote.js"></script>
	<script src="/managefunction.js"></script>
	</body>
</html>