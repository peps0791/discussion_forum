<html>
	<head>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>
		<script src = "/jquery-highlight.js"></script>
		<link href="/jquery.upvote.css" rel="stylesheet">
		<script src = "/jquery.upvote.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/style.css"/>
		<script src="/createlinks.js"></script>
		<script src="/textaudit.js"></script>
		<script src="/PorterStemmer1980.min.js"></script>
		<script src="/highlight.js"></script>
		<title id = 'pagetitle'>Why I'm getting very long terms in the inertia matrix (or dynamics model) of the robot using matlab script?
		</title>
	</head>
	<body id = 'pagebody'>
		<div id = "loginmodals"></div>
		<div id = "issuemodals"></div>
		<div id = "highlight_tool"></div>
		<div class = "container">
			<header>
				<h1>Just Another Discussion Forum</h1>
			</header>
			<div class="topnav" id="myTopnav">
				<a href="/home">Home</a>
				<a href = "#issueModal" data-toggle="modal" style = "float:right">Report Issue</a>
			</div>
			<div class = "content">
			<div id = "ques-6754" class = "post">
			<h2>Question</h2>
			<div id="vote-6754" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
				<p>Views :: 199</p>
			</div>
			<form id = "questionpostsform" method="GET" action = "/ask">
				<input type="submit" id = "quesbtn" class="btn btn-primary btn-lg" value="Ask Question">
			</form>
				<h2>Why I'm getting very long terms in the inertia matrix (or dynamics model) of the robot using matlab script?</h2>
<p>I'm working on the dynamics model of a RRRR articulated robot, I'm following Euler-Lagrange approach and developing my code in m-file in matlab; I'm looking for dynamic model of this form: $$
D(q) \ddot{q} + C(q,\dot{q})\dot{q}+ g(q) = \tau
$$
where $D$ and $C$ are $4 \times4$ matrices and $g$ and $\tau$ (torque) are $4\times1$ vectors; by formulating the kinetic and potential energies;;</p>

<p>The problem is that, I'm getting very long equations, and the term in $D$ matrix are very huge and nonlinear, involving sin and cos; I'm talking about a several pages per equation;
After I published the code - 7 pages - and the output I got around 45 pages in total;
I searched <a href="http://compgroups.net/comp.soft-sys.matlab/very-long-equations-of-motion-simulink/860201" rel="nofollow">around</a> there was some guy he faced the same problem before, but there was no helpful proposal.</p>

<p>Any Suggestions ?? </p>

			</div>
			<div class = "userinfosection"  id = "userinfo-6754" data-toggle = "popover">
				<p>user name : AlFagera</p>
				<p> user reputation : 99</p>
				<p class = "tagcontent" id = "usertaginfo-6754">{'control': 5, 'product-of-exponentials': 3, 'None': 4, 'manipulator': 0, 'inverse-kinematics': 0, 'torque': 1, 'pid': 2, 'simulation': 1, 'servomotor': 1, 'industrial-robot': 6, 'dh-parameters': 2, 'matlab': 2, 'robotic-arm': 10, 'jacobian': 0, 'kinematics': 2, 'dynamics': 5, 'forward-kinematics': 1, 'robotc': 1, 'input': 1}</p>
			</div><br>
			<br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-6754">Load Comments</button></br>
			<div id = "commentsection-6754" class = 'collapse'>
			<div id = "comment-9686" class = "comment">
				<p>It would be very hard for anyone to be helpful given that we don't have any idea how you derived those long formulae. There could be many issues; you could have made a mistake in the middle, there could be room for optimization (e.g., factoring out terms to get `sin(a+b)` out of its expanded form, etc), or otherwise the solution could actually just be long. Note also that sometimes it's better to have the answer in the form of multiplication of a couple matrices, than to do the multiplication by formula. In the later case, you may end up recalculating the same terms over and over.</p>
			</div>
			<div id = "comment-9692" class = "comment">
				<p>I'm following the popular form of Lagrange Equation, Taking Lagrangian L=K-V, (kinetic  energy)-(potential energy), it's not too long for the potential energy, but the kinetic energy I think cause the problem , because we need both the translational part and the rotational part, and the later involve the inertia matrices and consequently the rotation matrices, to bring all the stuff to the global frame, hopefully, this clarify my point ....</p>
			</div>
			<div id = "comment-17474" class = "comment">
				<p>Can you post a diagram of your setup along with the code you're using? Can you post *your* derivation of the Lagrangian? Are you then using the Langrangian correctly? $\frac{\partial L}{\partial q_i}=\frac{d}{dt} \left( \frac{\partial L}{\partial \dot{q}} \right) $? Note that, for the left side, you take the partial derivative with respect to $q$, and on the right side you take the partial derivative with respect to the *derivative* of q, $\dot{q}$.</p>
			</div>
			</div>
				<textarea id = "speech-6754" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-6754">
					<img id="start_img-6754" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-6754">Comment</button>

<h1>Answers</h1>
			<br><div id = "ans-6759"  class = "post">
				<h2>Answer</h2>
			<div id="vote-6759" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">3</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>It really doesn't sound very unexpected for your equations to become this long. Something that might help a little, is using <a href="http://www.mathworks.com/help/symbolic/sym.html#zmw57dd0e112213" rel="nofollow">assumptions</a> for defining symbolic variables.</p>

<pre><code>x = sym('x','real');
y = sym('y','positive');
z = sym('z','integer');
t = sym('t','rational');
</code></pre>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-6759" data-toggle = "popover">
				<p>user name : BarzinM</p>
				<p> user reputation : 316</p>
				<p class = "tagcontent" id = "usertaginfo-6759">{'None': 17}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-6759">Load Comments</button></br>
			<div id = "commentsection-6759" class = 'collapse'>
			<div id = "comment-9690" class = "comment">
				<p>I can tell you've been coding in Matlab a lot, from all the semicolons in your text :) .</p>
			</div>
			<div id = "comment-9693" class = "comment">
				<p>Not too much, but you see, I usually like to separate my sentences, Anyway, I already get 'real', before that I used to get conj. and very huge stuff; however, I don't think I need positive and integer.</p>
			</div>
			</div>
				<textarea id = "speech-6759" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-6759">
					<img id="start_img-6759" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-6759">Comment</button>
			<br><div id = "ans-6769"  class = "post">
				<h2>Answer</h2>
			<div id="vote-6769" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">2</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>When working with robotic matrices, such as transforms or dynamics, long-long-long equations are usually expected when everything is numerical. Using a symbolic platform such as MuPad or Maple will allow you to easily simplify the matrices symbolically (usually by using trigonometric identities).</p>

<p>Cheers,</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-6769" data-toggle = "popover">
				<p>user name : nnadeau</p>
				<p> user reputation : 21</p>
				<p class = "tagcontent" id = "usertaginfo-6769">{'None': 2}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-6769">Load Comments</button></br>
			<div id = "commentsection-6769" class = 'collapse'>
			<div id = "comment-9738" class = "comment">
				<p>I tried using MuPad, after I got my equations, copied one of them, and ask MuPad to simplify, combine or rewrite, but still very long. Furthermore, I noticed there are sum similar terms involving sin and cos; could be combined, but there are staying separately; I don't why this is happen, Do I need to make some assumptions in MuPad first or what, to simplify those trigonometric functions. I did not try Maple.</p>
			</div>
			<div id = "comment-9741" class = "comment">
				<p>Definitely use f2 := combine(f, sincos). Where f2 is the simplified function, f is the original function, "sincos" is a modifier which tells MuPad to combine trig terms. Check out http://www.mathworks.com/help/symbolic/mupad_ug/choose-simplification-functions.html for more info.</p>
			</div>
			</div>
				<textarea id = "speech-6769" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-6769">
					<img id="start_img-6769" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-6769">Comment</button>
			<br><div id = "ans-7031"  class = "post">
				<h2>Answer</h2>
			<div id="vote-7031" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">4</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>You can use the 'simplify' command , e.g : a=simplify(A*B) .This command is calculating some trigonometric functions thus making your expression shorter .</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-7031" data-toggle = "popover">
				<p>user name : giorgos_ts</p>
				<p> user reputation : 41</p>
				<p class = "tagcontent" id = "usertaginfo-7031">{'None': 4}</p>
			</div><br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-7031" class = 'collapse'>
			</div>
				<textarea id = "speech-7031" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-7031">
					<img id="start_img-7031" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-7031">Comment</button>
			<br><div id = "ans-12715"  class = "post">
				<h2>Answer</h2>
			<div id="vote-12715" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>Long formulas are to be expected. I actually have derived such equations of motion for a planar RRRR manipulator. I assumed real symbolic variables <code>assume(A, 'real')</code> and run <code>simplify()</code>. Generating code with MATLAB also creates intermediate variables. For the code output (in C) of a lower-triangular column-major order <code>D(q)</code> matrix, I got the following (after some manual clean-up):  </p>

<pre class="lang-c prettyprint-override"><code> void Mlt (
    const double *restrict in,
    const double *restrict pc,
    const double *restrict ma,
    const double *restrict a,
    const double *restrict q,
    const double *restrict g,
    double *restrict M)
{
/* inputs *
 * ****** *
Inertia and mass
double in[24]; [Ixx, Iyy, Izz, Ixy, Ixz, Iyz]
double pc[12]; [cog_x, cog_y, cog_z]
double ma[4]; [mass]

DH parameters
a is distance along x-axis (linkage length)
double a[4];

generalized coordinates
double q[4];

gravitational constant
double g[1];
 * ****** */

/* outputs *
 * ******* *
double M[16];
 * ******* */

  double t[64];
  t[0] = a[0]*a[0];
  t[1] = a[1]*a[1];
  t[2] = a[2]*a[2];
  t[3] = q[1]+q[2];
  t[4] = cos(t[3]);
  t[5] = q[2]+q[3];
  t[6] = cos(t[5]);
  t[7] = cos(q[1]);
  t[8] = cos(q[2]);
  t[9] = cos(q[3]);
  t[10] = q[1]+q[2]+q[3];
  t[11] = cos(t[10]);
  t[12] = ma[1]*t[1];
  t[13] = ma[2]*t[1];
  t[14] = ma[3]*t[1];
  t[15] = ma[2]*t[2];
  t[16] = ma[3]*t[2];
  t[17] = a[3]*a[3];
  t[18] = ma[3]*t[17];
  t[19] = pc[3]*pc[3];
  t[20] = ma[1]*t[19];
  t[21] = pc[6]*pc[6];
  t[22] = ma[2]*t[21];
  t[23] = pc[9]*pc[9];
  t[24] = ma[3]*t[23];
  t[25] = pc[4]*pc[4];
  t[26] = ma[1]*t[25];
  t[27] = pc[7]*pc[7];
  t[28] = ma[2]*t[27];
  t[29] = pc[10]*pc[10];
  t[30] = ma[3]*t[29];
  t[31] = a[1]*ma[1]*pc[3]*2.0;
  t[32] = a[2]*ma[2]*pc[6]*2.0;
  t[33] = a[3]*ma[3]*pc[9]*2.0;
  t[34] = a[1]*a[3]*ma[3]*t[6]*2.0;
  t[35] = a[1]*ma[3]*pc[9]*t[6]*2.0;
  t[36] = sin(t[3]);
  t[37] = sin(t[5]);
  t[38] = a[1]*a[2]*ma[2]*t[8]*2.0;
  t[39] = a[1]*a[2]*ma[3]*t[8]*2.0;
  t[40] = a[2]*a[3]*ma[3]*t[9]*2.0;
  t[41] = a[1]*ma[2]*pc[6]*t[8]*2.0;
  t[42] = a[2]*ma[3]*pc[9]*t[9]*2.0;
  t[43] = sin(q[1]);
  t[44] = sin(q[2]);
  t[45] = sin(q[3]);
  t[46] = sin(t[10]);
  t[47] = a[0]*a[2]*ma[2]*t[4];
  t[48] = a[0]*a[2]*ma[3]*t[4];
  t[49] = a[0]*ma[2]*pc[6]*t[4];
  t[50] = a[0]*a[3]*ma[3]*t[11];
  t[51] = a[0]*ma[3]*pc[9]*t[11];
  t[52] = a[1]*a[3]*ma[3]*t[6];
  t[53] = a[1]*ma[3]*pc[9]*t[6];
  t[54] = a[1]*a[2]*ma[2]*t[8];
  t[55] = a[1]*a[2]*ma[3]*t[8];
  t[56] = a[1]*ma[2]*pc[6]*t[8];
  t[57] = a[2]*a[3]*ma[3]*t[9];
  t[58] = a[2]*ma[3]*pc[9]*t[9];
  t[59] = q[0]+q[1]+q[2]+q[3];
  t[60] = cos(t[59]);
  t[62] = sin(t[59]);
  t[61] = a[3]*t[60]+pc[9]*t[60]-pc[10]*t[62];
  t[63] = a[3]*t[62]+pc[9]*t[62]+pc[10]*t[60];
  M[0] = in[2]+in[8]+in[14]+in[20]+t[12]+t[13]+t[14]+t[15]+t[16]+t[18]+t[20]+t[22]+t[24]+t[26]+t[28]+t[30]+t[31]+t[32]+t[33]+t[34]+t[35]+t[38]+t[39]+t[40]+t[41]+t[42]+ma[0]*t[0]+ma[1]*t[0]+ma[2]*t[0]+ma[3]*t[0]+ma[0]*(pc[0]*pc[0])+ma[0]*(pc[1]*pc[1])+a[0]*ma[0]*pc[0]*2.0+a[0]*a[2]*ma[2]*t[4]*2.0+a[0]*a[1]*ma[1]*t[7]*2.0+a[0]*a[2]*ma[3]*t[4]*2.0+a[0]*a[1]*ma[2]*t[7]*2.0+a[0]*a[1]*ma[3]*t[7]*2.0+a[0]*a[3]*ma[3]*t[11]*2.0+a[0]*ma[2]*pc[6]*t[4]*2.0+a[0]*ma[1]*pc[3]*t[7]*2.0+a[0]*ma[3]*pc[9]*t[11]*2.0-a[0]*ma[2]*pc[7]*t[36]*2.0-a[1]*ma[3]*pc[10]*t[37]*2.0-a[0]*ma[1]*pc[4]*t[43]*2.0-a[1]*ma[2]*pc[7]*t[44]*2.0-a[0]*ma[3]*pc[10]*t[46]*2.0-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[1] = in[8]+in[14]+in[20]+t[12]+t[13]+t[14]+t[15]+t[16]+t[18]+t[20]+t[22]+t[24]+t[26]+t[28]+t[30]+t[31]+t[32]+t[33]+t[34]+t[35]+t[38]+t[39]+t[40]+t[41]+t[42]+t[47]+t[48]+t[49]+t[50]+t[51]+a[0]*a[1]*ma[1]*t[7]+a[0]*a[1]*ma[2]*t[7]+a[0]*a[1]*ma[3]*t[7]+a[0]*ma[1]*pc[3]*t[7]-a[0]*ma[2]*pc[7]*t[36]-a[1]*ma[3]*pc[10]*t[37]*2.0-a[0]*ma[1]*pc[4]*t[43]-a[1]*ma[2]*pc[7]*t[44]*2.0-a[0]*ma[3]*pc[10]*t[46]-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[2] = in[14]+in[20]+t[15]+t[16]+t[18]+t[22]+t[24]+t[28]+t[30]+t[32]+t[33]+t[40]+t[42]+t[47]+t[48]+t[49]+t[50]+t[51]+t[52]+t[53]+t[54]+t[55]+t[56]-a[0]*ma[2]*pc[7]*t[36]-a[1]*ma[3]*pc[10]*t[37]-a[1]*ma[2]*pc[7]*t[44]-a[0]*ma[3]*pc[10]*t[46]-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[3] = in[20]+t[18]+t[24]+t[30]+t[33]+t[50]+t[51]+t[52]+t[53]+t[57]+t[58]-a[1]*ma[3]*pc[10]*t[37]-a[0]*ma[3]*pc[10]*t[46]-a[2]*ma[3]*pc[10]*t[45];
  M[5] = in[8]+in[14]+in[20]+t[12]+t[13]+t[14]+t[15]+t[16]+t[18]+t[20]+t[22]+t[24]+t[26]+t[28]+t[30]+t[31]+t[32]+t[33]+t[34]+t[35]+t[38]+t[39]+t[40]+t[41]+t[42]-a[1]*ma[3]*pc[10]*t[37]*2.0-a[1]*ma[2]*pc[7]*t[44]*2.0-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[6] = in[14]+in[20]+t[15]+t[16]+t[18]+t[22]+t[24]+t[28]+t[30]+t[32]+t[33]+t[40]+t[42]+t[52]+t[53]+t[54]+t[55]+t[56]-a[1]*ma[3]*pc[10]*t[37]-a[1]*ma[2]*pc[7]*t[44]-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[7] = in[20]+t[18]+t[24]+t[30]+t[33]+t[52]+t[53]+t[57]+t[58]-a[1]*ma[3]*pc[10]*t[37]-a[2]*ma[3]*pc[10]*t[45];
  M[10] = in[14]+in[20]+t[15]+t[16]+t[18]+t[22]+t[24]+t[28]+t[30]+t[32]+t[33]+t[40]+t[42]-a[2]*ma[3]*pc[10]*t[45]*2.0;
  M[11] = in[20]+t[18]+t[24]+t[30]+t[33]+t[57]+t[58]-a[2]*ma[3]*pc[10]*t[45];
  M[15] = in[20]+ma[3]*(t[61]*t[61])+ma[3]*(t[63]*t[63]);

}
</code></pre>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-12715" data-toggle = "popover">
				<p>user name : ChisholmKyle</p>
				<p> user reputation : 46</p>
				<p class = "tagcontent" id = "usertaginfo-12715">{'None': 3}</p>
			</div><br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-12715" class = 'collapse'>
			</div>
				<textarea id = "speech-12715" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-12715">
					<img id="start_img-12715" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-12715">Comment</button>
			</div>
			<div id = "resourcestab" class = "resourcestab">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#resources">Resources</a></li>
					<li><a data-toggle="tab" href="#summary">Summary</a></li>
				</ul>
					<div class="tab-content">
						<div id="resources" class="tab-pane fade in active">
							<h3>Resources</h3>
							<div id = "resourcescontent"></div>
						</div>
						<div id="summary" class="tab-pane fade">
							<h3>Summary</h3>
							<div id = "summarycontent"></div>
						</div>
			</div>
			</div>
			<footer>Moore & Peps collaboration.</footer>
	</div>
	<script src="/post.js"></script>
	<script type="text/javascript">
		$("#loginmodals").load("/loginModal.html");
		$("#issuemodals").load("/issueModal.html");
		$("#highlight_tool").load("/highlight_tool.html");
		checkLoggedInUser()
		var content = $('.content').html();
		populateResources(content)
		getHighlights()
		setOnLinksHover()
	</script>
	<script src="/media.js"></script>
	<script src="/vote.js"></script>
	<script src="/managefunction.js"></script>
	</body>
</html>