<html>
	<head>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>
		<script src = "/jquery-highlight.js"></script>
		<link href="/jquery.upvote.css" rel="stylesheet">
		<script src = "/jquery.upvote.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/style.css"/>
		<script src="/createlinks.js"></script>
		<script src="/textaudit.js"></script>
		<script src="/PorterStemmer1980.min.js"></script>
		<script src="/highlight.js"></script>
		<title id = 'pagetitle'>Length and Width of a Line Following Robot
		</title>
	</head>
	<body id = 'pagebody'>
		<div id = "loginmodals"></div>
		<div id = "issuemodals"></div>
		<div id = "highlight_tool"></div>
		<div id = "reward_tool"></div>
		<div id = "comment_tool"></div>
		<div class = "container">
			<header>
				<h1>Just Another Discussion Forum</h1>
			</header>
			<div class="topnav" id="myTopnav">
				<a href="/home">Home</a>
				<a href = "#issueModal" data-toggle="modal" style = "float:right">Report Issue</a>
			</div>
			<div class = "content">
			<div id = "ques-8556" class = "post">
			<h2>Question</h2>
			<div id="vote-8556" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">2</span>
				<a class="downvote"></a>
				<a class="star"></a>
				<p>Views :: 595</p>
			</div>
			<form id = "questionpostsform" method="GET" action = "/ask">
				<input type="submit" id = "quesbtn" class="btn btn-primary btn-lg" value="Ask Question">
			</form>
				<h2>Length and Width of a Line Following Robot</h2>
<p>I'm building a line following robot. I have made different chassis designs. The main prototype I'm using is a rectangle base. At one side motors are placed. On the other side of the rectangle caster wheel is placed in the middle. Look at the following image.</p>

<p><a href="https://i.stack.imgur.com/e89HK.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/e89HK.png" alt="Robot Design Prototype"></a></p>

<p>By varying the values of <code>distance</code>, I have seen that the stability of the robot is varying rapidly. </p>

<p>I'm driving the robot using <code>PID</code>. I have seen that for some chassis designs it is very hard(sometimes impossible) to calculate correct constant values. And for some chassis it is very easy. By the word <strong>stability</strong> I meant this. I have a feeling that the robot dimensions, <code>distance</code> values and that stability has a relationship..</p>

<p>Is there an equation or something that can be used to estimate the value of the <code>distance</code> when the width of the robot is known..?</p>

<p>Other than that is there a relationship between robot weight and diameter of the wheel or robot dimensions and the diameter..?</p>

<p>Thanks for the attention!!</p>

			</div>
			<div class = "userinfosection"  id = "userinfo-8556" data-toggle = "popover">
				<p>user name : Ramesh-X</p>
				<p> user reputation : 157</p>
				<p class = "tagcontent" id = "usertaginfo-8556">{'None': 1, 'kalman-filter': 3, 'probability': 3, 'arduino': 5, 'line-following': 2, 'pid': 2, 'motor': 2, 'pwm': 0, 'automatic': 3}</p>
			</div><br>
			<br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-8556">Load Comments</button></br>
			<div id = "commentsection-8556" class = 'collapse'>
			<div id = "comment-13881" class = "comment">
				<p>Can you give us more information about what you mean by "stability"? I'm guessing you mean that the caster wheel is on a bit of an offset so it causes the vehicle to turn a bit when driving in reverse (to the right in your image)? If the caster wheel was just a ball with minimal friction then changing the distance _shouldn't_ make any difference to the kinematics at all.</p>
			</div>
			<div id = "comment-13884" class = "comment">
				<p>Word stability is explained in the post. I edited the earlier post.</p>
			</div>
			<div id = "comment-13885" class = "comment">
				<p>Great, that helps a lot. How is your PID controller working? Are you controlling both speed and turn rate?</p>
			</div>
			<div id = "comment-13886" class = "comment">
				<p>PID algorithm is generating a values according to the error of sensor reading. The generated value is used to change the mid speed value of the motor. `setMotorSpeed(midSpeed + value, midSpeed - value)`

According to the sign of the value, speed changes and robot turns..</p>
			</div>
			<div id = "comment-13887" class = "comment">
				<p>Cool, so you are maintaining a constant `midSpeed` and then varying `value` to turn.</p>
			</div>
			<div id = "comment-13888" class = "comment">
				<p>yep.. Is there a better way to do the turning part..? And any suggestions to my question in the post..?</p>
			</div>
			<div id = "comment-13889" class = "comment">
				<p>I think you are doing things correctly, the main question is whether or not the caster is causing the problem. In most cases you can ignore it for defining the kinematics (it is only necessary to maintain balance for the robot). Have you derived the PID control law based on a kinematic model or just applied it through trial and error?</p>
			</div>
			<div id = "comment-13890" class = "comment">
				<p>Just through trial and error.. I like to use a kinematic model. But I haven't found any source to learn how to model that kind of a scenario. If you can, a help(link to a website) will be appreciated..</p>
			</div>
			<div id = "comment-13891" class = "comment">
				<p>No problem. One last question: what is the desired input to the PID controller? Robot heading direction? I understand it is for line-following so presumably you have some light sensor looking for the line?</p>
			</div>
			<div id = "comment-13892" class = "comment">
				<p>A value is generated according to the position of the line, below the sensor panel. Set point of the `PID` controller is the value generated when the panel is symmetrically on the line. Error is calculated by subtraction setPoint and the current value of the sensor panel..</p>
			</div>
			<div id = "comment-13893" class = "comment">
				<p>Okay I think you need to add a diagram to explain this -- you are very familiar with your design but I can't understand what you mean exactly. What are the units of setPoint? Metres?</p>
			</div>
			<div id = "comment-13894" class = "comment">
				<p>Let us [continue this discussion in chat](http://chat.stackexchange.com/rooms/32224/discussion-between-ramesh-x-and-brian-lynch).</p>
			</div>
			</div>
				<textarea id = "speech-8556" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-8556">
					<img id="start_img-8556" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-8556">Comment</button>

<h1>Answers</h1>
			<br><div id = "ans-8558"  class = "post">
				<h2>Answer</h2>
			<div id="vote-8558" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">5</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>Actually, the caster wheel has ideally no effect on the kinematics of the vehicle. In reality there will be some resistance from the caster wheel that does impact the vehicle motion, but we can still ignore it for the sake of designing a control law.</p>

<p>Based on the extended discussion in the comments, your sensor can be used to measure the <em>lateral error</em> of the robot with respect to the line it is following. Consider the diagram below, where the robot position is depicted with a dark blue circle and its direction of motion is the red arrow (with constant speed $v$). The lateral error is $e$ (perpendicular distance to the line), while the heading error is $\alpha$ (angle of the velocity with respect to the line).</p>

<p><a href="https://i.stack.imgur.com/XPuXI.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/XPuXI.png" alt="enter image description here"></a></p>

<p>What you care about is having a control law that controls the robot heading so that an appropriate value of $\alpha$ causes $e$ to be minimized. To do that, consider the <em>error dynamics</em> of $e$:</p>

<p>$\dot{e} = v \sin \alpha$</p>

<p>Which can be extended to:</p>

<p>$\ddot{e} = v \dot{\alpha} \cos \alpha$</p>

<p>If we ignore the fact that the line direction may be changing (valid for most cases similar to roads), then the rate of change of the heading error is approximately the rate of change of the robot heading (turn rate $\omega$):</p>

<p>$\dot{\alpha} \approx \omega$</p>

<p>$\ddot{e} = v \omega \cos \alpha$</p>

<p>Now comes the tricky part. What we really want to do is minimize the error $e$ by controlling the turn rate $\omega$, but the above equation is non-linear and we prefer to design control laws with linear systems. So let's make up a new control input $\eta$ that is related to $\omega$:</p>

<p>$\eta = v \omega \cos \alpha$</p>

<p>Then we can make a feedback control law for $\eta$. I'll go straight to the answer and then follow it up with the details if you are interested...</p>

<p>The feedback controller can be a full PID as shown below:</p>

<p>$\eta = -K_p e - K_d \dot{e} - K_i \int e dt$</p>

<p>And then we calculate the necessary turn rate $\omega$:</p>

<p>$\omega = \frac{\eta}{v \cos \alpha}$</p>

<p>Normally you might do this by using a measurement of $\alpha$, but since you are only measuring $e$ you could just assume that term is constant and use:</p>

<p>$\omega = \frac{\eta}{v}$</p>

<p>Which is really just using a PID control law for $\omega$ based on $e$ but now with the factor $\frac{1}{v}$ in the gains.</p>

<p>With $\omega$ known, you can compute the necessary wheel speed differential as follows (based on your variable names, and where $b$ is the width between wheels):</p>

<p><code>midSpeed + value</code> $ = \frac{1}{2} \omega b + v$</p>

<p>$v = $ <code>midSpeed</code></p>

<p><code>value</code> $= \frac{1}{2}\omega b$</p>

<p>Overall, you are computing $\omega$ using a PID control law as a function of lateral error $e$ (coming from your sensor). You then compute <code>value</code> from the value for $\omega$ and use it to determine the left and right wheel speeds.</p>

<hr>

<p>Now, read on for more details regarding the error dynamics and linearized control system:</p>

<p>We can write out the system dynamics like this, where we consider $z$ to be the vector of the error states.</p>

<p>$z = \begin{bmatrix} \dot{e} \\ e \end{bmatrix}$</p>

<p>$\dot{z} = \begin{bmatrix} 0 &amp; 0 \\ 1 &amp; 0 \end{bmatrix} z + \begin{bmatrix} 1 \\ 0 \end{bmatrix} \eta$</p>

<p>If you are familiar with linear control theory then you can start to see how this is a convenient form where we can make a feedback control law with input $\eta$ as a function of the error:</p>

<p>$\eta = -\begin{bmatrix} K_d &amp; K_p \end{bmatrix} z$</p>

<p>$\dot{z} = \begin{bmatrix} 0 &amp; 0 \\ 1 &amp; 0 \end{bmatrix} z - \begin{bmatrix} 1 \\ 0 \end{bmatrix} \begin{bmatrix} K_d &amp; K_p \end{bmatrix} z$</p>

<p>$\dot{z} = \begin{bmatrix} -K_d &amp; -K_p \\ 1 &amp; 0 \end{bmatrix} z$</p>

<p>This closed-loop system has the following characteristic equation:</p>

<p>$s^2 + K_d s + K_p = 0$</p>

<p>Which results in the poles (this is a PD control law, not PID):</p>

<p>$p = -\frac{1}{2}K_d \pm \sqrt{\frac{1}{4}K_d^2 - Kp}$</p>

<p>So if you wanted a critically damped system with no oscillations around the line, you could choose one of the gains and use the following relationship to get the other (start with smaller gains and tune until you get the response you want):</p>

<p>$K_p = \frac{1}{4}K_d^2$</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-8558" data-toggle = "popover">
				<p>user name : Brian Lynch</p>
				<p> user reputation : 1237</p>
				<p class = "tagcontent" id = "usertaginfo-8558">{'None': 85}</p>
			</div><br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-8558">Load Comments</button></br>
			<div id = "commentsection-8558" class = 'collapse'>
			<div id = "comment-13910" class = "comment">
				<p>No problem, the only thing I didn't talk about was how to convert your 8-bit sensor reading into an estimate of the lateral error. That shouldn't be too hard but let me know if you need some ideas!</p>
			</div>
			<div id = "comment-13911" class = "comment">
				<p>I can do that.. But I have another question. When implementing this kind of a kinematic model, there can be error due to factors like mass, friction of the robot. How to minimize the error due to those factors..? Do I need to implement a kinetic model..? I think it would be hard..</p>
			</div>
			<div id = "comment-13912" class = "comment">
				<p>What I have shown here is for a robot like yours but assuming that the wheel does not slip sideways. Mass has no consequence here since our input is the actual turn rate $\omega$, not the applied torque. This then assumes your robot has its own control system for applying appropriate voltage to the motors to achieve the input turn rate and speed. You are referring to a _dynamic model_, which is indeed harder but not too difficult. The real question is: do you need to? If your robot accepts $v$ and $\omega$ commands, then you don't have to worry about it.</p>
			</div>
			</div>
				<textarea id = "speech-8558" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-8558">
					<img id="start_img-8558" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-8558">Comment</button>
			</div>
			<div id = "resourcestab" class = "resourcestab">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#resources">Resources</a></li>
					<li><a data-toggle="tab" href="#highlights">Highlights</a></li>
				</ul>
					<div class="tab-content">
						<div id="resources" class="tab-pane fade in active">
							<h3>Links from the Page</h3>
							<div id = "resourcescontent"></div>
						</div>
						<div id="highlights" class="tab-pane fade">
							<h3>Highlights</h3>
							<div id = "highlightcontent"></div>
						</div>
			</div>
			</div>
			<footer>Moore & Peps collaboration.</footer>
	</div>
	<script src="/post.js"></script>
	<script type="text/javascript">
		$("#loginmodals").load("/loginModal.html");
		$("#issuemodals").load("/issueModal.html");
		$("#highlight_tool").load("/highlight_tool.html");
		$("#comment_tool").load("/comment_tool.html");
		$("#reward_tool").load("/reward_tool.html");
		checkLoggedInUser()
		var content = $('.content').html();
		populateResources(content)
		getHighlights()
		setOnLinksHover()
	</script>
	<script src="/media.js"></script>
	<script src="/vote.js"></script>
	<script src="/managefunction.js"></script>
	</body>
</html>