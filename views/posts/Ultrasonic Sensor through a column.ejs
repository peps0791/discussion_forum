<html>
	<head>
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="  crossorigin="anonymous"></script>
		<script src = "/jquery-highlight.js"></script>
		<link href="/jquery.upvote.css" rel="stylesheet">
		<script src = "/jquery.upvote.js" type="text/javascript"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<link rel="stylesheet" href="/style.css"/>
		<script src="/createlinks.js"></script>
		<script src="/textaudit.js"></script>
		<script src="/PorterStemmer1980.min.js"></script>
		<script src="/highlight.js"></script>
		<title id = 'pagetitle'>Ultrasonic Sensor through a column
		</title>
	</head>
	<body id = 'pagebody'>
		<div id = "loginmodals"></div>
		<div id = "issuemodals"></div>
		<div id = "highlight_tool"></div>
		<div class = "container">
			<header>
				<h1>Just Another Discussion Forum</h1>
			</header>
			<div class="topnav" id="myTopnav">
				<a href="/home">Home</a>
				<a href = "#issueModal" data-toggle="modal" style = "float:right">Report Issue</a>
			</div>
			<div class = "content">
			<div id = "ques-10101" class = "post">
			<h2>Question</h2>
			<div id="vote-10101" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
				<p>Views :: 302</p>
			</div>
			<form id = "questionpostsform" method="GET" action = "/ask">
				<input type="submit" id = "quesbtn" class="btn btn-primary btn-lg" value="Ask Question">
			</form>
				<h2>Ultrasonic Sensor through a column</h2>
<p>I am trying to measure the height of water inside a column. The column is 50mm in dia and 304mm long. I have mounted the sensor just above the column.</p>

<p><a href="https://i.stack.imgur.com/c2yzF.jpg" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/c2yzF.jpg" alt="enter image description here"></a></p>

<p>To measure the accuracy of the sensor, I filled the column up to a known value (a) and got the average sensor reading (b). a+b should give me the height of the sensor from the base of the column.</p>

<p>Repeating this for different values of a, I got very different values for (a+b). see attached chart.</p>

<p><a href="https://i.stack.imgur.com/OwfU5.png" rel="nofollow noreferrer"><img src="https://i.stack.imgur.com/OwfU5.png" alt="enter image description here"></a></p>

<p>My question is</p>

<ol>
<li>Is the sensor expected to have error of this order? </li>
<li>Is my setup of confining the sensor through a column producing such errors. </li>
<li>Any other ideas to get the water column height. Please note that during the actual test, the water inside will be oscillating (up and down).I am thinking of making a capacitive sensor using aluminium foil. Water will work as the dielectric and the level of water will determine the capacitance.</li>
</ol>

<p>P.S. I also did some open tests (not through a column) to get the distance of a fixed object, and it was quite accurate.</p>

<p>Any help is appreciated.</p>

<p>Arduino Code</p>

<pre><code>#include &lt;NewPing.h&gt;

#define TRIGGER_PIN  7  // Arduino pin tied to trigger pin on the ultrasonic sensor.
#define ECHO_PIN     8  // Arduino pin tied to echo pin on the ultrasonic sensor.
#define MAX_DISTANCE 200 // Maximum distance we want to ping for (in centimeters). Maximum sensor distance is rated at 400-500cm.

double DB_ROUNDTRIP_CM = 57.0;

NewPing sonar(TRIGGER_PIN, ECHO_PIN, MAX_DISTANCE); // NewPing setup of pins and maximum distance.

void setup() {
  Serial.begin(9600); // Open serial monitor at 115200 baud to see ping results.
}

void loop() {
  delay(100);
  unsigned int uS = sonar.ping();
  double d = uS / DB_ROUNDTRIP_CM;


  Serial.println(d);
}
</code></pre>

			</div>
			<div class = "userinfosection"  id = "userinfo-10101" data-toggle = "popover">
				<p>user name : nightcrawler23</p>
				<p> user reputation : 108</p>
				<p class = "tagcontent" id = "usertaginfo-10101">{'None': 0, 'ultrasonic-sensors': 1, 'arduino': 1}</p>
			</div><br>
			<br><h3>Comments</h3>
				<button data-toggle = 'collapse' data-target = "#commentsection-10101">Load Comments</button></br>
			<div id = "commentsection-10101" class = 'collapse'>
			<div id = "comment-17961" class = "comment">
				<p>I don't understand what your X axis represents.</p>
			</div>
			<div id = "comment-17962" class = "comment">
				<p>Sorry about it. The X-axis are the different water levels I've tested for. I have update the chart.</p>
			</div>
			<div id = "comment-17965" class = "comment">
				<p>I'm wondering if you might be getting standing waves in the column, like the pipe of a pipe organ. What is the frequency of your sound?</p>
			</div>
			<div id = "comment-17977" class = "comment">
				<p>I am using a library NewPing for arduino. Not sure if the library sets the frequency by itself. I however have a delay of 100ms in loop. So that makes the frequency 10Hz. I have added the code.</p>
			</div>
			</div>
				<textarea id = "speech-10101" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-10101">
					<img id="start_img-10101" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-10101">Comment</button>

<h1>Answers</h1>
			<br><div id = "ans-10102"  class = "post">
				<h2>Answer</h2>
			<div id="vote-10102" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">0</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>Ultrasound sensors like this have a very wide beam spread. In fact the word "beam" is completely inappropriate. So I think you're right, confining it like this is likely to cause problems.</p>

<p>To test this, set the sensor up in free air then put a solid obstacle beside the beam, but a few centimetres clear of it. It'll probably cause stray readings.</p>

<p>If you need to measure in such a narrow column, I'm not sure what you could do... <strong>very</strong> high frequency ultrasound sensors have a narrower beam, but they are expensive. Maybe you could have some sort of optical sensors, arranged beside the column, and a "float" placed in there to block the sensors...</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-10102" data-toggle = "popover">
				<p>user name : Andy</p>
				<p> user reputation : 796</p>
				<p class = "tagcontent" id = "usertaginfo-10102">{'None': 59}</p>
			</div><br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-10102" class = 'collapse'>
			</div>
				<textarea id = "speech-10102" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-10102">
					<img id="start_img-10102" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-10102">Comment</button>
			<br><div id = "ans-10122"  class = "post">
				<h2>Answer</h2>
			<div id="vote-10122" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">0</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><blockquote>
  <p>Is the sensor expected to have error of this order?</p>
</blockquote>

<p>In brief, yes. All sensors will have some degree of noise, which is characterized by the manufacturer. To avoid this, you can use a different sensor, or you can apply filtering to a very large dataset to extract the correct measurement. If you have the budget for it, a laser and photodetector of some sort will certainly give you better (less noise) results. Otherwise, you can apply a Kalman Filter or some other probabilistic technique to get a better estimate of the ground truth measurement.  </p>

<blockquote>
  <p>Is my setup of confining the sensor through a column producing such
  errors.</p>
</blockquote>

<p>Since you are using an ultra-sonic sensor, which has a conical "beam", the column will be acting as a wave-guide, and you can expect interference as a result, especially for smaller depths; this will increase measurement noise.</p>

<blockquote>
  <p>Any other ideas to get the water column height.</p>
</blockquote>

<p>I think that the ultra-sonic sensor will work under two assumptions. First, you must apply some sort of filter/technique to estimate the true measurement based on the noisy measurements. I recommend <em>Probabilistic Robotics</em> by Sebastian Thrun for learning how to do this--it is well covered. The second assumption is that you don't need extreme precision. </p>

<p>Another approach to the problem would be to set up a camera, and use computer vision techniques to estimate depth; this is probably as easy as what you are doing, but it will require a different experimental setup. </p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-10122" data-toggle = "popover">
				<p>user name : NBCKLY</p>
				<p> user reputation : 741</p>
				<p class = "tagcontent" id = "usertaginfo-10122">{'None': 44, 'roomba': 4, 'irobot-create': 4, 'arduino': 2}</p>
			</div><br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-10122" class = 'collapse'>
			</div>
				<textarea id = "speech-10122" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-10122">
					<img id="start_img-10122" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-10122">Comment</button>
			<br><div id = "ans-10482"  class = "post">
				<h2>Answer</h2>
			<div id="vote-10482" class="upvote" style="float:left;">
				<a class="upvote"></a>
				<span class="count">1</span>
				<a class="downvote"></a>
				<a class="star"></a>
			</div>
				<p><p>I think the code is just fine. You must however test the code by placing ultrasonic sensor at fixed distance from the wall and testing the distance. Also, it seems you are using <strong>SR04</strong> ultrasonic sensor which has a beam angle of <strong>15 degrees</strong> and accuracy of <strong>3mm</strong>. This might result beam being reflected from water column container. As mentioned in the datasheet <a href="http://www.micropik.com/PDF/HCSR04.pdf" rel="nofollow">SR04 DataSheet</a>, minimum area of measurement must be <strong>0.5 square meters</strong> to get correct readings.</p>
</p><br>
			</div>
			<div class = "userinfosection"  id = "userinfo-10482" data-toggle = "popover">
				<p>user name : Bharat Joshi</p>
				<p> user reputation : 106</p>
				<p class = "tagcontent" id = "usertaginfo-10482">{'None': 6}</p>
			</div><br><h3>Comments</h3><p>no comments yet<p><br>
			<div id = "commentsection-10482" class = 'collapse'>
			</div>
				<textarea id = "speech-10482" rows="3" cols="80"></textarea><br>
				<button class="record-start" id="start-10482">
					<img id="start_img-10482" src="/mic.gif" alt="Start">
				</button>
				<button class = "comment-btn" id = "comment-btn-10482">Comment</button>
			</div>
			<div id = "resourcestab" class = "resourcestab">
				<ul class="nav nav-tabs">
					<li class="active"><a data-toggle="tab" href="#resources">Resources</a></li>
					<li><a data-toggle="tab" href="#summary">Summary</a></li>
				</ul>
					<div class="tab-content">
						<div id="resources" class="tab-pane fade in active">
							<h3>Resources</h3>
							<div id = "resourcescontent"></div>
						</div>
						<div id="summary" class="tab-pane fade">
							<h3>Summary</h3>
							<div id = "summarycontent"></div>
						</div>
			</div>
			</div>
			<footer>Moore & Peps collaboration.</footer>
	</div>
	<script src="/post.js"></script>
	<script type="text/javascript">
		$("#loginmodals").load("/loginModal.html");
		$("#issuemodals").load("/issueModal.html");
		$("#highlight_tool").load("/highlight_tool.html");
		checkLoggedInUser()
		var content = $('.content').html();
		populateResources(content)
		getHighlights()
		setOnLinksHover()
	</script>
	<script src="/media.js"></script>
	<script src="/vote.js"></script>
	<script src="/managefunction.js"></script>
	</body>
</html>